{
  "commissionfee": {
    "title": "Commission Fee Adjustment Proposal",
    "description": "StaFi is committed to continuously improving our products to ensure the best possible user experience. Given the competitive market for Liquid Staking Derivatives (LSD), we have decided to adjust our strategy in order to further expand our reach. After conducting a detailed comparison between StaFi and other LSD protocols, we are proposing to update our commission fee structure for our Staking Derivatives.",
    "date": "2023-03-01T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": null,
    "preview": "StaFi is committed to continuously improving our products to ensure …",
    "content": "\n\nStaFi is committed to continuously improving our products to ensure the best possible user experience. Given the competitive market for Liquid Staking Derivatives (LSD), we have decided to adjust our strategy in order to further expand our reach. After conducting a detailed comparison between StaFi and other LSD protocols, we are proposing to update our commission fee structure for our Staking Derivatives.\n\n# Abstract\n\nWe propose adjusting the commission fee to 10%. Please note that StaFi only charges an overall commission fee of 10% from the staking reward in the pool. Out of the 10% commission fee, 5% will be allocated to the StaFi DAO treasury and 5% will be allocated to validators.\n\nBy implementing this approach, stakers and validators will receive greater benefits from StaFi’s staking services, but it may result in a decrease in income for the StaFi DAO treasury to a certain degree.\n\n# Motivation\n\nAs the Ethereum Shanghai Upgrade approaches, it is expected to not only enable ETH withdrawals but also accelerate the growth of the Liquid Staking Derivatives (LSD) industry. This will bring more confidence to users and may attract more participation from large and institutional investors. Additionally, the current Ethereum network’s Staking Ratio stands at 13.79%, with over 15 million ETHs deposited. Considering the size of the Ethereum network, this is a minuscule fraction of the total supply.\n\nTo benefit from this wave of stakers that the Ethereum upgrade will bring and make StaFi stand out from its competitors to further capture a larger portion of the market, we will need to solve two vital problems: the lack of liquidity for rETH and the rETH Depeg problem. These two problems are strongly correlated, as rETH liquidity is fundamental to maintaining its Peg as well as perpetuating DeFi use cases. The ETH Peg issue could be solved through arbitraging liquidity pools making rETH suitable to be used as the base for DeFi Applications, such as Leveraged Staking and Lending/Borrowing Protocols.\n\nThe StaFi team is actively exploring various solutions to tackle the issue of rETH liquidity. Our approach includes incentivizing liquidity pools and improving our staking products. Regarding liquidity incentives, we are presently engaging with multiple decentralized exchanges (DEXs), such as Balancer and Camelot, to include rETH incentives in their pools. We are also connecting with lending protocols like Radiant and Demex to establish rETH Defi use cases. Additionally, in terms of product improvement, we recently launched our new rToken App, which significantly enhances the user experience and simplifies staking with LSDs. As a result, we are now focusing on improving our user commission fees as another aspect of product enhancement.\n\n# Specifications\n\n## The need to reduce Commission Fees\n\nGiven the highly competitive market for Liquid Staking Derivatives, StaFi is currently exploring all possible avenues to attract more users and achieve rapid growth. A potential strategy is to reduce user commission fees, as this has proven to be an effective way of incentivizing users to stake. Lower fees may also improve rETH APY and help maintain the peg of ETH/rETH by increasing the pool’s depth and liquidity, thereby contributing to the overall growth of the StaFi ecosystem.\n\n## Commission Fee Structure: 10% overall Commission Fee with 5% commissions paid to validators\n\nThe StaFi Foundation is committed to prioritizing growth above all else. In order for StaFi to be a mutually beneficial ecosystem, it is crucial to incentivize stakers to participate in the project and contribute to its growth.\n\nThere are several commission fee structures available for selection. One of them would be to follow the majority of projects and charge a total of 10% user commission fees. The commission rate received by the validator will change based on the amount of ETH they stake. All validators will have a base commission rate, which increases as they stake more. This encourages validators to stake and run nodes. Additionally, our minimum threshold is only 4 ETH to run a node, which is relatively low compared to all other projects on the market.\n\nAnother option is for the Foundation to collect 10% of all profits in the pool, with 5% going to the validator and 5% to the StaFi Treasury. This option aligns with the commission fee structure of the majority of decentralized LSD projects and may be more attractive to users due to its lower fee. However, the earnings of the validator and the StaFi Treasury will also decrease to a certain extent with the reduction in user fees. Nonetheless, we believe that as long as more new users are added, the total earnings will definitely be higher.\n\nAfter conducting a comprehensive comparison of other LSD projects in the market and considering StaFi’s current strategic development needs and technical human resources, the Foundation has decided to implement the second option of charging a 10% overall commission fee. This decision was made to attract more users to stake in StaFi.\n\nThe Foundation may make further adjustments to the commission fee structure based on development needs and community feedback in the future.\n\n## Comparison between StaFi and other LSD projects\n\n![commission fee](/image/commission_1.png \"commission fee\")\n\n## Comparison of old and new Commission Fee Structures\n\n**Before**:\n\n- Users are charged a 19% staking reward commission.\n- Validators get 10%*(1–10%) of overall staking rewards and are charged a 10% staking reward commission of their own staking capital part.\n- Example: After earning a 1 ETH reward, StaFi takes a 10% cut, and the validator takes 10% of the remaining fees. The distribution of the remaining 81% ETH reward is based on the ratio of the validator’s capital to the user’s capital.\n\n**After**:\n\n- Overall, a 10% commission is charged on staking rewards, with 5% allocated to validators and 5% to the StaFi DAO Treasury.\n- Example: After earning a 1 ETH reward, StaFi takes a 10% cut, allocating 5% to validators and 5% to the StaFi DAO Treasury. The distribution of the remaining 90% ETH reward is based on the ratio of the validator’s capital to the user’s capital.\n\n## Comparison of old and new commission fee structures for Validators\n\n**Example**:Alice is a solo validator for StaFi, with a staked amount of 4 ETH. When the StaFi pool received a 1 ETH reward, the pool’s total staked amount was 32 ETH.\n\n**Before**:\n- Rewards: 1*9% + 1*81% * 4/32 = 0.19125 ETH\n- Final Rewards: 0.19125 * (1–10%) = 0.172125 ETH\n\n**After**:\n- Rewards: 1*5% + 1*90%*4/32=0.1625 ETH\n- Final Rewards: 0.1625 * (1–5%)=0.154375 ETH\n\n## StaFi DAO Treasury Commissions\n- Before: Gets 10% from the Staking Pool\n- After: Gets 5% from the Staking Pool\n\n# Conclusion\n\nThe team is currently focused on making improvements to the platform, and once approved, the proposed changes to the commission fee calculation mechanism will be implemented in one week following this proposal. The new mechanism will come into effect as soon as it is developed. There will be no changes to the rules for calculating staked tokens.\n\nYour feedback and suggestions regarding this proposal are highly valued, and we encourage you to leave a comment below if you have any ideas for changes or additions that could benefit the community.\n",
    "iso8601Date": "2023-03-01T00:00:00+00:00",
    "basename": "commissionfee"
  },
  "ics": {
    "title": "[Discussion Draft] Interchain Security (ICS) on StaFiHub for Enhanced Security, Decentralization, and Scalability",
    "description": "StaFiHub-ICS represents a transformative approach, aiming to redefine the operational framework of StaFi consumer chains. It’s a step towards meeting the ever-evolving needs of our stakeholders and staying ahead in the competitive landscape of liquid staking. This proposal provides the opportunity for our community to engage in a meaningful discussion about our future direction and to shape the growth trajectory of StaFiHub. The time is ripe for us to consider and act upon the potential benefits of ICS adoption, and this proposal serves as the beacon guiding us through that process.",
    "date": "2023-06-13T00:00:00.000Z",
    "status": 1,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/discussion-draft-interchain-security-ics-on-stafihub-for-enhanced-security-decentralization-and-scalability/86/1",
    "preview": "# Introduction\n\nThis forum thread outlines a significant proposal …",
    "content": "\n\n# Introduction\n\nThis forum thread outlines a significant proposal for the adoption of Interchain Security (ICS) from Cosmos Hub by StaFiHub, marking a potential paradigm shift in our approach to blockchain security and scalability. In the dynamic ecosystem of decentralized finance, it’s essential to continually innovate and adapt. This proposal is not just a discussion paper but a call to action, signaling our intent to revolutionize StaFi Tokenomics, highlighted in our StaFi Tokenomics V2 Proposal, which encompasses key elements like FIS, rToken, and our consumer chains.\n\nStaFiHub-ICS represents a transformative approach, aiming to redefine the operational framework of StaFi consumer chains. It’s a step towards meeting the ever-evolving needs of our stakeholders and staying ahead in the competitive landscape of liquid staking. This proposal provides the opportunity for our community to engage in a meaningful discussion about our future direction and to shape the growth trajectory of StaFiHub. The time is ripe for us to consider and act upon the potential benefits of ICS adoption, and this proposal serves as the beacon guiding us through that process.\n\nStaFiHub previously launched in Q3 2022 based on the ComosSDK with the purpose of providing liquid staking solutions to Cosmos Ecosystem PoS Networks and Protocols and current has 4 solutions deployed up to date, namely for ATOM, IRIS, HUAHUA, and SWTH. Since then, StaFiHub has implemented IBC (Interblockchain Connections) and ICA (Interchain Accounts) to help bolster security and decentralization, ultimately removing the need for Multi-signature address signing from validators.\n\nTo further increase security, StaFiHub proposes to implement the Interchain Security Feature (ICS) which further allows us to increase security and decentralization to ensure high safety for stakers and validators on the StaFiHub network.\n\n# Motivation\n\nAAs we delve into the core of this proposal, it’s important to start with an understanding of StaFiHub’s current landscape. Our platform operates on a permission chain status, a model that has been effective but also encounters certain scalability issues. Scalability, in the world of blockchain technology, is not a luxury, but a necessity, one that ensures sustainable growth and responsiveness to increasing demands.\n\nA significant concern that warrants our attention is the scenario where the Total Value Locked (TVL) in StaFiHub surpasses the FIS staked value in the Chain. This situation is more than a statistical imbalance; it presents a potential security risk that needs to be addressed promptly.\n\nTo further expound on this, the Total Value Locked (TVL) represents the aggregate value of assets currently being staked or locked in StaFiHub’s smart contracts. On the other hand, the FIS staked value in the Chain signifies the amount of FIS tokens staked by the validators securing our network. In an ideal scenario, the FIS staked value should be at par with or exceed the TVL to maintain a secure network.\n\nHowever, if the TVL exceeds the FIS staked value, it could incentivize malicious actors to corrupt the network. They might attempt to take over the network by staking more FIS tokens than currently staked, in order to steal the assets locked in StaFiHub’s contracts. This situation is often referred to as a ‘51% attack’ and poses a significant threat to the security and integrity of our platform.\n\nInterchain Security (ICS) from Cosmos Hub emerges as a compelling solution to these challenges. ICS represents an innovative approach to blockchain security, offering a robust architecture that could safeguard our platform against such threats. Furthermore, the adoption of ICS is not just about enhancing security; it also promises to boost the scalability of the StaFi Solution, a crucial factor for our continued success and growth.\n\nIn conclusion, the integration of ICS could be a critical step towards resolving our current issues, fortifying our platform’s security, and setting the stage for our future expansion.\n\n# Interchain Security\n\nInterchain Security (ICS) is an innovative solution from Cosmos Hub designed to address pressing issues related to blockchain security and scalability. As the blockchain ecosystem continues to expand, there is an increasing need for reliable and scalable security measures. ICS aims to meet these needs, providing a robust security framework that can help ensure the integrity and reliability of consumer chains.\n\nAt its core, ICS is a security protocol that allows multiple chains to share the security of one or more ‘provider’ chains. This shared security model is based on the idea of ‘shared security’, where validators of a provider chain also validate transactions on the consumer chains. By leveraging the security resources of the provider chain, consumer chains can enhance their own security, reducing the risk of attacks.\n\nIn addition to improved security, ICS also offers scalability benefits. As the number of consumer chains grows, the security resources of the provider chain can be efficiently shared among them. This allows for the scalability of the entire network without compromising on security. Consequently, platforms adopting ICS can scale their operations effectively, meeting the growing demands of users and developers alike.\n\nIn the context of StaFiHub, adopting ICS would mean that our platform would become a consumer chain of Cosmos Hub. This would allow us to leverage the security resources of Cosmos Hub, enhancing the security of our platform and enabling us to scale our operations more effectively.\n\nFurthermore, it’s important to understand the concept of a CCV (Cross Chain Validation) module and CCV channel, which form the core of the Interchain Security system. The CCV module is the component that implements the CCV protocol, with both the provider and the consumer chains each having their own CCV module. The functionalities provided by these CCV modules differ between the provider chain and the consumer chains, with separate modules for the provider chain (provider CCV module) and the consumer chains (consumer CCV module). In addition, a unique, ordered IBC channel, known as the CCV channel, is used by the provider CCV module to exchange IBC packets with a consumer CCV module. This setup ensures that there’s a separate CCV channel for every consumer chain.\n\n# Robust Security through Interchain Security v1\n\nThrough the Interchain Security V1 module, security becomes a shared responsibility facilitated by the Cosmos ecosystem, replacing the previous reliance on StaFiHub’s validators. This is enabled by the implementation of Interchain Security v1, a shared security model that allows for the security of multiple blockchains to be maintained by a single validator set.\n\nInterchain Security v1 allows validators on the provider chain (Cosmos Hub) to use stake on that chain to participate in the consensus of a consumer chain in parallel. In the context of StaFi, Cosmos Hub becomes the provider chain, and StaFi, the consumer chain. The same validator set that builds blocks on the Cosmos Hub also secures the StaFi chain, fostering trust through shared security.\n\nThis shared security model, enabled by the Inter-Blockchain Communication (IBC) protocol, allows for efficient and secure cross-chain information transfer. The IBC application layer integrates additional functionalities introduced with an Interchain Standard (ICS).\n\nThe Cosmos ecosystem, known for its robustness and reliability, boasts a Total Value Locked (TVL) of $2.3 billion staked ATOM at the time of writing, which greatly exceeds that of StaFiHub. This vast disparity in staked value means that Cosmos is well-equipped to provide a high level of security for StaFiHub. The high TVL on Cosmos not only strengthens its security but also provides a strong disincentive for malicious behavior.\n\nIn this new model, the validators of StaFiHub are removed once the Interchain Security v1 is implemented. This shifts the security responsibility entirely onto the Cosmos ecosystem, streamlining the process and ensuring that the StaFiHub ecosystem is secured by a more substantial, established network.\n\nKey to this security process are two crucial operations that the Cross-Chain Validation (CCV) must handle: Validator Set Update and Reward Distribution. Validator Set Update is a two-part operation. Firstly, it involves updating the validator sets of all consumer chains based on information obtained from the provider’s Staking module (i.e., the Staking module on the provider chain) regarding the amount of tokens bonded by validators on the provider chain. Secondly, it ensures the timely completion (relative to the unbonding periods on the consumer chains) of unbonding operations, i.e., operations of unbonding bonded tokens.\n\nThe second operation, Reward Distribution, enables the distribution of block production rewards and transaction fees from the consumer chains to the validators on the provider chain. This process ensures a fair reward system for all validators, thereby maintaining the robustness of the network.\n\nIn conclusion, the new iteration of the StaFi protocol leverages Interchain Security v1 to eliminate the need for StaFiHub’s validators, thereby streamlining security and operations. The move towards a shared security model lowers the barrier for launching application-specific blockchains with high security guarantees, while also strengthening the overall resilience of the StaFi protocol.\n\n# Cross Chain Validator (CCV)\n\nIn terms of operations, CCV must manage several, but we believe the following types are of paramount importance:\n\n- CCV Module: This refers to the module which puts into action the CCV protocol. Both the provider and consumer chains each possess their own distinct CCV module. It’s noteworthy that the functions provided by the CCV module differ between the provider chain and the consumer chains. To simplify, we use the terms ‘provider CCV module’ and ‘consumer CCV module’ to indicate the CCV modules on the provider chain and the consumer chains, respectively.\n- CCV Channel: This is a unique, ordered IBC channel which the provider CCV module employs to exchange IBC packets with a consumer CCV module. It’s important to note that there exists an individual CCV channel for every consumer chain.\n\n\n# Validator Set Update\n\nThis operation is bifurcated into two distinct parts:\n\nUpdating the validator sets of all the consumer chains, using the information gathered from the provider Staking Module (Staking module of the provider chain). This information pertains to the quantity of tokens that validators on the provider chain have bonded.\n\nFacilitating the prompt completion of unbonding operations, referring to the process of unbonding bonded tokens. This is important relative to the unbonding periods on the consumer chains.\n\n![ics](/image/ics_1.png \"ics\")\n\nReward Distribution: This operation ensures the distribution of block production rewards and transaction fees from the consumer chains to the validators on the provider chain. This is a crucial process for maintaining a fair and balanced reward system.\n\n![ics](/image/ics_2.png \"ics\")\n\n# Benefits of ICS Adoption\n\nThe adoption of Interchain Security (ICS) provides a multitude of potential benefits and challenges to StaFiHub, ranging from improved security mechanisms to enhanced scalability, and beyond.\n\nBenefits:\n- Enhanced Security: With Interchain Security v1, StaFiHub will benefit from a shared security model with the Cosmos Hub. The same validator set will build blocks on both chains, ensuring high security guarantees. This robust security setup will increase trust among users and developers in our platform.\n- Improved Decentralization: The implementation of Interchain Security v1 will improve the decentralization of StaFiHub. Validators on the provider chain (Cosmos Hub) will participate in the consensus of our platform in parallel, creating a more decentralized and secure network.\n- Greater Scalability: As the Cosmos ecosystem continues to grow and evolve, adopting Interchain Security ensures that it is equipped to handle the increased demand and complexity that comes with a larger number of rTokens, users, and developers. This makes StaFiHub more resilient and adaptable to future developments and further rToken deployments.\n- Increased Token Utility: With enhanced security, improved decentralization, and greater scalability, we can expect increased adoption of StaFiHub liquid staking solutions. This, in turn, will enhance the token utility of FIS on StaFiHub, reflecting positively on the overall health and robustness of the StaFi ecosystem.\n\nIn addition to these core benefits, the integration of ICS can potentially make StaFiHub more attractive to substantial investors, institutions, and DAOs. This is due to the increased security, decentralization, and scalability that ICS offers, which are key considerations for these stakeholders. As such, the adoption of ICS could lead to an increase in the adoption and TVL of StaFiHub.\n\nChallenges:\n- Technical Challenges in Implementing ICS: The transition to Interchain Security v1 will involve substantial technical complexities. It requires integration with the Inter-Blockchain Communication (IBC) protocol and managing increased data storage and processing. Although we have strategies in place to mitigate these challenges, unforeseen technical hurdles may arise during the implementation process.\n- Potential Resistance from the StaFiHub Community: Changes of this magnitude can lead to resistance from some community members, particularly validators who will have to be removed from producing blocks. Clear communication and education will be key to assuaging these concerns, but some resistance should be anticipated.\n- Transitioning Validators: The transition from a StaFiHub specific validator set to relying on the Cosmos ecosystem for security is a significant shift and will require careful planning and execution. Validators will need to be transitioned out as Interchain Security is implemented.\n- Reliance on Cosmos Validator Set: With the adoption of Interchain Security V1, StaFiHub’s security will become heavily reliant on the Cosmos validator set. This introduces a new challenge as it creates a potential single point of failure. If the Cosmos validator set were to be compromised or fail, it could have serious implications for the security and functionality of StaFiHub. The reliance on the Cosmos validator set also means that any issues within the Cosmos ecosystem, such as disagreements among validators or changes in the validator set composition, could directly affect StaFiHub. Therefore, StaFiHub will need to have measures in place to manage these risks, including robust monitoring of the Cosmos validator set and contingency plans for potential issues.\n- Development Plan: We understand that moving to Interchain Security v1 will involve significant changes. Therefore, we have formulated a clear plan for this transition. This includes necessary testing, staged rollouts, and other preparatory steps to ensure a seamless shift to this new security model.\n\nBy diligently addressing these challenges, StaFiHub can successfully implement ICS and unlock a more secure, decentralized, and scalable future. The commitment to technical expertise, transparent communication, community engagement, validator support, rigorous testing, and compliance will pave the way for StaFiHub to harness the full potential of ICS, drive innovation, and create lasting value for its ecosystem and stakeholders.\n\n# Conclusion\n\nIn conclusion, the adoption of Interchain Security v1 presents a transformative opportunity for StaFiHub. By implementing this groundbreaking solution from Cosmos Hub, we can reinvent our approach to blockchain security and scalability. The integration of Interchain Security v1 will enable us to rely on the established security of the Cosmos Hub validator set, thereby enhancing the security and maximizing the value for our token holders. While challenges may arise, such as the potential over-reliance on the Cosmos validator set and other technical complexities, we are prepared to navigate these obstacles through clear communication, support for validators, and a well-defined transition plan.\n\nThe benefits of adopting Interchain Security v1 are substantial. It will provide enhanced security by leveraging a shared security model, instilling trust among users and developers. Furthermore, the improved decentralization and greater scalability will enable us to build a more robust and scalable platform, accommodating the growing demands of our ecosystem. Additionally, the integration of Interchain Security v1 will increase the utility of our tokens, making StaFiHub more attractive to investors, institutions, and DAOs.\n\nAs we embark on this journey, we recognize the importance of addressing technical challenges and collaborating closely with our community. Together, we can seize this opportunity to fortify the security of our platform, drive innovation, and shape the future of decentralized finance. We invite our community to actively engage in discussions, provide valuable feedback, and join us in realizing the potential of Interchain Security v1 for the continued growth and success of StaFiHub.",
    "iso8601Date": "2023-06-13T00:00:00+00:00",
    "basename": "ics"
  },
  "sip1": {
    "title": "[SIP-1] LST for EVM compatible chains",
    "description": "The EVM Network has become one of the most popular and influential blockchain networks. However, using the current approach to build LST on these chains would result in high costs and a poor user experience for users, as well as limited scalability for StaFi, requiring significant development effort.",
    "date": "2023-03-15T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/sip-1-lst-for-evm-compatible-chains/69",
    "preview": "# Problem\n\n- When users stake EVM Network tokens such as BNB or …",
    "content": "\n\n# Problem\n\n- When users stake EVM Network tokens such as BNB or MATIC, they need to connect two wallets and sign multiple transactions to complete the staking process.\n- When users interact with decentralized exchanges (DEX) on Ethereum, BSC, or Polygon using rTokens, if the rToken is on StaFi Chain, they will need to pay additional gas fees to bridge the rToken to the target chain.\n\n# Motivation\n\nThe EVM Network has become one of the most popular and influential blockchain networks. However, using the current approach to build LST on these chains would result in high costs and a poor user experience for users, as well as limited scalability for StaFi, requiring significant development effort. This SIP provides a solution that can reduce transaction costs and usage barriers for users while maintaining scalability as a general architecture.\n\n# Specification\n\n## Overview\n\nThe newly proposed EVM LST solution is redesigned for security and composability. Differing from the current solution, the main feature of the new solution is that rToken will be directly issued on the target chain. This eliminates the need for cross-chain communication when users obtain rTokens, and enables easy integration of rToken into DeFis on the target chain, given the same token standard.\n\nThe primary difference between the two solutions lies in the ecosystem of the chain on which rToken issuance depends. To promote composability, target chains should have a variety of use cases for rTokens, including DEXes, Lendings, Options, Index, and more. This will facilitate widespread adoption of rToken. If such use cases are not available on the target chain, we would suggest issuing rToken on StaFi Chain, as rDEX will be able to serve as the DEX for rToken trading on that platform.\n\nPreconditions for the new solution:\n\n- The target chain should have a contract layer\n- The staking model is built within the contract layer\n\nAs the solution is mainly built for EVM LSD, the contract layer should also be EVM compatible. While it is theoretically possible to implement the solution on all VMs, evaluation would need to be performed for VMs with different sets.\n\nIf the preconditions are not met, the development process will be costly and time-consuming, and there may not be a feasible solution for the chain. On the other hand, the benefits of the new EVM LSD solution are obvious, offering high-level security and composability. Additionally, an EVM-compatible chain with a staking model would be similar to StaFi’s, making the integration process straightforward and simple, potentially only requiring a copy-paste approach.\n\n## Architecture\n\nThe current architecture\n\n![EVM](/image/sip1_1.png \"EVM\")\n\nThe new architecture\n\n![EVM](/image/sip1_2.png \"EVM\")\n\n- Target Chain: The chain intends to support LSTs, such as rETH on Ethereum.\n- Staking Contracts: On-chain processing logic for StaFi staking.\n- Original Staking Contract: The original staking contract is a smart contract that allows users to stake their tokens in order to participate in the network’s consensus mechanism and earn rewards, such as deposit contract on Ethereum.\n- rToken Relay: Listens for events, handles numerical computations, votes to the staking contracts, and processes staking data once per era.\n- rToken: Only support the target chain’s token standard, such as ERC20 on Ethereum.\n\n## Interface and Integration\n\nWe have previously studied multi-wallet components 1 that currently only support EVM Network. We plan to integrate these components into the frontend and also integrate more EVM Network services for data analysis and security.\n\n# Security Considerations\n- Security module: The migration process involves shifting the security module from chain security to contract security, which presents potential security vulnerabilities that must be carefully monitored and addressed.\n- Contract layer: The migration from rust-solidity also poses potential risks to the contract layer, which must be assessed and managed to ensure the overall integrity and security of the solution.\n\n# Copyright\n\nCopyright and related rights waived via CC0.",
    "iso8601Date": "2023-03-15T00:00:00+00:00",
    "basename": "sip1"
  },
  "sip2": {
    "title": "[SIP-2] StaFi Tokenomics V2",
    "description": "As the rToken solution extends across numerous ecosystems - including Layer1s, sidechains, Cosmos appchains, and beyond - the tokenomics of StaFi are confronted with challenges that need to support this expansion. These challenges consist of balancing the value of rTokens with chain security, incentivizing validators in StaFi appchains, and establishing a robust on-chain voting system for governance. The issues at hand largely center around the complex nature of the intertwined tokenomics, which include FIS tokenomics, rTokenomics, and appchain tokenomics.",
    "date": "2023-06-06T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/sip-2-stafi-tokenomics-v2/84",
    "preview": "# Introduction\n\nAs the rToken solution extends across numerous …",
    "content": "\n\n# Introduction\n\nAs the rToken solution extends across numerous ecosystems - including Layer1s, sidechains, Cosmos appchains, and beyond - the tokenomics of StaFi are confronted with challenges that need to support this expansion. These challenges consist of balancing the value of rTokens with chain security, incentivizing validators in StaFi appchains, and establishing a robust on-chain voting system for governance. The issues at hand largely center around the complex nature of the intertwined tokenomics, which include FIS tokenomics, rTokenomics, and appchain tokenomics.\n\nStaFi is progressing towards becoming a leading liquid staking infrastructure provider, aiming to offer solutions for the majority of PoS chains. Consequently, ensuring our tokenomics are sustainably updated is essential. Moreover, the rToken solution has been extensively developed for nearly two years, with the staked value in StaFi reaching $60 million. As the native token of the StaFi Protocol, FIS should bear the responsibility of capturing value alongside the growth of rTokens.\n\nThis proposal is aimed to provide a comprehensive explanation of our plan to update StaFi’s tokenomics. By offering a detailed outline of the process, StaFi can better engage with the community and receive valuable feedback. Additionally, we aim to utilize this opportunity to ensure the delivery of a high-quality product by StaFi.\n\n# Why Adopt StaFi Tokenomic V2\n\nThe LSD market is experiencing rapid changes, demanding scalable and secure rToken solutions to keep up with this trend. In response to these changes, StaFi is actively developing an open LSD infrastructure for the market. The goal is to create a product that can not only address current challenges in Layer1 tokens, but also effectively tackle future issues that may arise. StaFi’s commitment to enhancing competitiveness revolves around a deep understanding of the PoS mechanism, which will serve as a crucial feature for other LSD providers to emulate.\n\nTo grasp the urgency of the impending shift, we must first comprehend the existing landscape. The fast-paced expansion of rTokens across various rToken appchains has led to a complex tokenomic structure. Presently, StaFi operates two distinct appchains, with the prospect of additional ones in the future. While FIS staking in StaFiChain is permissionless, staking in StaFiHub is yet to be community-led and is currently managed by a trusted validator set. The incentive for these validators stems from the treasury of StaFiChain. As explained in rTokenomic V1 2, running two staking mechanisms simultaneously is untenable. Moreover, there may be concerns about centralization and chain security if the value staked in rTokens issued on StaFiHub grows significantly. Inflation-induced FIS rewards from the treasury contribute to FIS supply dilution, but this is a necessary expenditure to maintain an appchain.\n\nStaFi has proposed launching more Appchains, such as the StaFi Subnet on Avalanche, StaFi Paratime on Oasis, StaFi Supernet on Polygon, and others. However, the introduction of multiple Appchains further complicates StaFi’s Tokenomics and puts its security and decentralization at risk.\n\nTo put it simply, FIS cannot concurrently serve as the native token for multiple appchains, as its inflated value would be insufficient to safeguard the staked value of rTokens.\n\nFor StaFi to achieve enhanced scalability, it’s crucial to disassociate the security of rTokens from that of the appchains. The rTokenomics need to be adequately protected, receiving inherent security from the target chain. There are two main strategies currently available: issuing rTokens in the target chain or adopting a shared consensus mechanism.\n\nIn essence, StaFi Tokenomic V2 is an upgrade to the tokenomic structure, offering the StaFi community a comprehensive understanding of how various systems operate in tandem. As an asset management platform and an open LSD infrastructure, rTokens are issued on appchains, and appchains with consensus adhere to a distinct tokenomic model. Concurrently, FIS acts as a behind-the-scenes facilitator, transferring value within these appchains. This triadic structure might appear perplexing to the community, and even the first iterations of StaFi Tokenomic and rTokenomic didn’t fully consider LSD extensions. Tokenomics V2 is purposefully designed to navigate the intricate relationships amongst these StaFi participants, with the aim of making it more accessible and sustainable. This implies upcoming changes in StaFi’s tokenomics.\n\nIn conclusion, these new modifications will facilitate the sustainable growth and governance of StaFi, create value for FIS, substantially bolster rToken security, and ensure the scalability of the rToken solution for prospective expansion.\n\n# Specifications\n\nThis proposal is designed to revamp the tokenomics of FIS, rTokens, and StaFi appchains. The following updates will adhere to the following principles:\n\n- Keep the tokenomics as simple as possible.\n- Ensure that the StaFi protocol remains sustainable, interoperable, and scalable.\n- Enhance the value and governance roles of FIS for its holders in tandem with the ecosystem’s growth.\n\nThese principles will profoundly influence the StaFi tokenomics. The primary proposed changes include:\n\n- FIS Tokenomics: FIS will remain the primary token of StaFiChain (deployed on Polkadot Substrate), and it will continue to be bridgeable to Ethereum (ERC20), StaFiHub (deployed on Cosmos SDK, ICS20), and more among other chains. Governance voting will be exclusively performed on StaFiChain, and subsequent aspects can be finalized, including burn strategy, inflation strategy, and treasury usage, among others.\n- rTokenomics: Apart from rFIS, rTokens will be decoupled from the security of StaFi appchains. This would result in the staked value being safeguarded by the target chain instead of StaFi. The rToken issuance contract will be deployed on the target chains, thereby enhancing rTokens’ interoperability.\n- Appchain Tokenomics: The security provider for the StaFi appchains will be determined based on usage. The FIS appchain will rely on staked FIS for security. EVM rTokens will utilize the security of the target chains, while Cosmos rTokens can acquire security from ATOM stakers via the ICS module. EVM LSD’s and Cosmos LSD’s can address the majority of situations in the PoS chains space, and additional infrastructures may be provided to new Layer1 tokens as a supplement , such as Move LSD infrastructure.\n\nThe proposed alterations require updates to two open LSD infrastructures: previously issued rTokens, such as rBNB and rMATIC, that were deployed on StaFiChain, will be migrated and re-deployed on the target chain. rTokens issued on StaFiHub, like rATOM and rIRIS will remain the same, but the consensus will be updated to incorporate the ICS security module. Future rTokens will employ either the EVM LSD or Cosmos LSD solution for mainnet launches.\n\nPost-update, the security of StaFiChain will be ensured by staked FIS. There will be no TVL in StaFiChain apart from rFIS TVL. Regarding the ICS integration, StaFi will distribute FIS from its treasury to incentivize Cosmos security providers. Security will be anchored on staked ATOM but will be related to FIS.\n\nThere are no significant changes to the utility of FIS in Tokenomic V2. However, the utilities are now more distinct and easier to comprehend. Primary utilities include:\n\n- Staking: Staking FIS provides security to the chain, yielding rewards and gaining voting power in return.\n- Governance: FIS holders are owners of StaFi and can stake FIS to govern both StaFi and rToken solutions.\n- Value Capture: FIS holders can capitalize on the value generated by the rToken solutions.\n\nFIS’s inflation and burn mechanisms will follow the same rules 3 set in V1. Parts of the inflated FIS goes to the Treasury, which depends on the staking ratio of FIS. The burn mechanism can be activated if the FIS in the Treasury has not been used in a certain period of time. The period is a timer set in the genesis. Even the inflation can be updated in the governance. The Treasury is an engine that bootstraps and keeps StaFi sustainable in the long run.\n\nStaFi charges a commission ranging from 5% to 10% from different rToken solutions, and an additional redemption fee may apply. These fees are sent to the treasury pool. As more fees are generated from rToken solutions, FIS holders have the right to decide how to utilize these rewards. They can be distributed among FIS holders, remain in the Treasury, or be used for the buy-back-burn strategy.\n\nAll the parameters mentioned above can be voted on-chain and updated by the community. Governance proposals will be raised on StaFiChain, and staked FIS and rFIS (backed by staked FIS) holders can gain voting power. They have the right to govern the direction of StaFi.\n\n# Roadmap\n\nTo achieve the roadmap of an open LSD infrastructure, progressive steps need to be taken. The first milestone or priority should be the adoption of shared/replicated security. After that, appchain security should be decoupled from StaFiChain, and then rTokens solution can be decoupled from the appchains. This means that rTokens should be redeployed on the target chains. In this process, it would be possible to form an LSD infrastructure to be a LSD middleware, which means a more generalized structure, even an LSD SDK.\n\nThere will be challenges. ICS integration would need to be voted on and passed by the Cosmos governance. Abstracting a LSD middleware as an infrastructure may face a generalized issue. Even a LSD SDK may not be applicable for the market as it changes rapidly. However, with the update of the Tokenomics of StaFi, StaFi has more possibilities in the staking industry.\n\n# ICS integration\n\nStaFi proposes ICS integration as a means to decouple security between chains and total value locked (TVL). Considering that Cosmos has a larger staked value and consequently a higher market cap, ICS can offer enhanced security to other chains with LSDs. StaFiHub is pushing for ICS integration to unlock more possibilities for future LSDs. The success of Neutron 1, the first consumer chain to utilize ICS, provides a compelling case for this integration. By leveraging security from Cosmos, Neutron has positioned itself as a DeFi hub within the Cosmos ecosystem. Following this model, StaFi aims to replicate this security through Cosmos ICS, with a formal proposal set to follow.\n\n# rToken decoupling\n\nThe decoupling of rTokens comprises two components. First, it involves the adoption of ICS for rTokens within StaFiHub, which will separate rToken security from StaFiHub. The second component is related to rTokens within StaFiChain. Apart from rFIS, all rTokens will gradually shift towards either the EVM LSD solution or the VM LSD solution. As part of this transition, these rTokens will be redeployed on their respective target chains, a process which will require time for development and audits. The abstraction of LSD infra will occur simultaneously. Once completed, the rToken solution will be scalable.\n\n# Governance\n\nStaFiChain is set to activate its governance in the near future. In this new arrangement, appchains will no longer carry the prefix “StaFi-xx.” Instead, they will be referred to by their deployment in the target chain system. For instance, StaFiHub will be renamed as “StaFi deployed on Cosmos,” and StaFi Subnet will become “StaFi deployed on Avalanche.” FIS staked in StaFi deployments using the Substrate framework will govern all solutions.\n\nProposals can be raised on a variety of subjects, such as Treasury usage, inflation rate, rToken commission, and rToken deployment. Further details about on-chain voting, including FIS voting, the voting system, and the voting quorum, will be clarified through a governance proposal. This proposal will outline the governance process for the future.\n\n# Tools\n\nThere will be a variety of tools available to display statistics related to rTokens, governance, integrations, liquidity, transparency, and more. Additionally, the integration of third-party tools will be crucial for establishing a complete LSD infrastructure. For instance, Dune, Defillama and Token Terminal have already been integrated to display rToken-related statistics. These tools keep track of the visualizations of token performance, market related trends and data, and trading volumes across multiple exchanges. As the LSD infrastructure expands and evolves, the range of tools and integrations will also grow, offering users more ways to engage with the platform and refine their trading strategies.\n\n# Benefits\n\nThe proposed changes offer clear advantages. By decoupling StaFi’s Tokenomics from the security of rTokens, the protocol will enjoy enhanced scalability, leading to a more decentralized and transparent future. As we transition towards a Decentralized Autonomous Organization (DAO), we will see the elimination of permissioned Appchains, no constraints on growing staked value, and a strategic progression of StaFi in the right direction.\n\nHowever, these changes also bring potential drawbacks, particularly concerning FIS tokenomics. Questions arise, such as how to capture value growth when rTokens and appchains are decoupled from StaFi. Although the utility of the FIS token hasn’t dramatically changed, its role has evolved more towards that of a governance token. With voting power tied to staking, FIS stakers can determine treasury usage and govern protocol updates. Despite decoupling, FIS remains a key driver of the protocol and community. The implications for FIS tokenomics will become clearer as development progresses.\n\n# Risk\n\n- Smart Contracts: These form the backbone of any decentralized finance (DeFi) system, including StaFi. However, as with any cryptographic application, they carry inherent risks such as coding vulnerabilities or potential hacking.\n- Decoupled Migration: The proposed strategy involves redeploying rTokens to a different chain. This necessitates a migration process where assets are transferred from StaFi appchains to the target chain. This process could introduce risks associated with redeployment and asset migration.\n- Integration Failure: StaFiHub is exploring integration with the Inter-Blockchain Communication (ICS) protocol. However, this endeavor could fail if Cosmos stakers deny access, disrupting the planned expansion.\n\nAs with any major change, there may be unforeseen risks associated with the proposed modifications. We encourage community members to share their insights and concerns.\n\nThis is an open forum for discussion. None of the proposed changes will be implemented before a thorough community discourse has taken place. If no substantial feedback is received, the core team will initiate the proposed changes on the mainnet in the near future. Subsequently, the roadmap will guide governance voting and the activation of an on-chain proposal system for the community.",
    "iso8601Date": "2023-06-06T00:00:00+00:00",
    "basename": "sip2"
  },
  "sip3": {
    "title": "[SIP-3]A New Implementation of rBNB using EVM LSD Architecture",
    "description": "rBNB is an important part of the rToken, issued on the StaFi Chain. However, there are some usability issues. Firstly, users need to have two wallets and sign multiple transactions to mint rBNB. Secondly, if users want to participate in DEX trading on Binance Smart Chain (BSC), they need to bridge rBNB from the StaFi Chain to BSC. Finally, burning rBNB requires doing it on the StaFi Chain, which means bridging rBNB from BSC back to the StaFi Chain.",
    "date": "2023-07-16T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/sip-3-a-new-implementation-of-rbnb-using-evm-lsd-architecture/87",
    "preview": "# Abstract\n\nIn SIP-1 2, we discussed the benefits of the EVM LSD …",
    "content": "\n\n# Abstract\n\nIn SIP-1 2, we discussed the benefits of the EVM LSD universal architecture. In SIP-2, we discussed the decoupling of rTokens.This proposal suggests migrating rBNB to the new architecture and decoupling it . After the migration is completed, both the usability and security of rBNB will be improved.\n\n# Motivation\n\nrBNB is an important part of the rToken, issued on the StaFi Chain. However, there are some usability issues. Firstly, users need to have two wallets and sign multiple transactions to mint rBNB. Secondly, if users want to participate in DEX trading on Binance Smart Chain (BSC), they need to bridge rBNB from the StaFi Chain to BSC. Finally, burning rBNB requires doing it on the StaFi Chain, which means bridging rBNB from BSC back to the StaFi Chain.\n\nSwitching rBNB to the EVM LSD architecture can solve the usability issues mentioned above. Additionally, we have made some security updates, including introducing the Native Staking contract interface for BSC, multisig and simplifying relay services, among others.\n\n# Specification\n\n## Overview\n\n![BNB](/image/sip3_1.jpeg \"BNB staking\")\n\nThere are mainly three components:\n\n- Staking contracts on BSC: A new set of contracts has been designed to implement liquid staking on the BSC.\n- rBNB relay: A newly designed and simplified service is used to trigger Era updates in the contract for delegation and undelegation operations. Additionally, it synchronizes unrewarded data from the BSC chain that has not yet been synced to the contract to ensure the accuracy of rBNB exchange rates.\n- System staking contract on BSC: A system contract in charge of handling staking requests on BSC.\n\n## Contract\n\nThis new set of contracts has been specifically designed to enable liquid staking on the BSC, offering all the fundamental features of a BNB liquid staking service, including minting and burning rBNB, depositing and withdrawing BNB, as well as staking pool management, among other functionalities.\n\n### System Staking Contract Interface\n\nThe BSC provides contract interfaces for staking, which enable the implementation of staking-related features on the BSC by using IStaking.sol.\n\n```js\npragma solidity 0.7.6;\n\n// SPDX-License-Identifier: GPL-3.0-only\n\ninterface IStaking {\n    function delegate(address validator, uint256 amount) external payable;\n\n    function undelegate(address validator, uint256 amount) external payable;\n\n    function redelegate(address validatorSrc, address validatorDst, uint256 amount) external payable;\n\n    function claimReward() external returns (uint256);\n\n    function claimUndelegated() external returns (uint256);\n\n    function getDelegated(address delegator, address validator) external view returns (uint256);\n\n    function getTotalDelegated(address delegator) external view returns (uint256);\n\n    function getDistributedReward(address delegator) external view returns (uint256);\n\n    function getPendingRedelegateTime(\n        address delegator,\n        address valSrc,\n        address valDst\n    ) external view returns (uint256);\n\n    function getUndelegated(address delegator) external view returns (uint256);\n\n    function getPendingUndelegateTime(address delegator, address validator) external view returns (uint256);\n\n    function getRelayerFee() external view returns (uint256);\n\n    function getMinDelegation() external view returns (uint256);\n\n    function getRequestInFly(address delegator) external view returns (uint256[3] memory);\n}\n```\n### Staking Pool\n\n**Data Structs**\n\n```js\nEnumerableSet.AddressSet bondedPools;\nmapping(address => PoolInfo) public poolInfoOf;\nmapping(address => EnumerableSet.AddressSet) validatorsOf;\nmapping(address => uint256) public latestRewardTimestampOf;\nmapping(address => uint256) public undistributedRewardOf;\nmapping(address => uint256) public pendingDelegateOf;\nmapping(address => uint256) public pendingUndelegateOf;\nmapping(address => mapping(address => uint256)) public delegatedOfValidator; // delegator => validator => amount\nmapping(address => bool) waitingRemovedValidator;\nmapping(uint256 => uint256) public eraRate;\n\n// unstake info\nuint256 public nextUnstakeIndex;\nmapping(uint256 => UnstakeInfo) public unstakeAtIndex;\nmapping(address => EnumerableSet.UintSet) unstakeOfUser;\n```\n\n- `poolInfoOf`: record the information and status about the staking pool .\n- `validatorsOf`: record sets of validator addresses, where each set represents the validators to which StaFi has delegated staking pool BNB.\n- `latestRewardTimestampOf`: record the block number of the last time the StaFi received staking rewards.\n- `undistributedRewardOf`: record the undistributed staking rewards.\n- `pendingDelegateOf`: record pending delegated amounts.\n- `pendingUndelegateOf`: record pending undelegated amounts.\n- `delegatedOfValidator`: record the delegated amounts to this validator.\n- `waitingRemovedValidator`: record whether this validator is waiting to be removed.\n- `eraRate`: record rBNB exchange rate\n- `unstakeAtIndex`: record the unstake info.\n- `unstakeOfUser`: record the unbond index of users who have not withdrawn.\n\n**Events**\n\n```js\nevent Stake(address staker, address poolAddress, uint256 tokenAmount, uint256 rTokenAmount);\nevent Unstake(address staker, address poolAddress, uint256 tokenAmount, uint256 rTokenAmount, uint256 burnAmount,uint256 unstakeIndex);\nevent Withdraw(address staker, address poolAddress, uint256 tokenAmount, uint256[] unstakeIndexList);\nevent ExecuteNewEra(uint256 indexed era, uint256 rate);\nevent Settle(uint256 indexed era, address indexed pool);\nevent RepairDelegated(address pool, address validator, uint256 govDelegated, uint256 localDelegated);\nevent SetUnbondingDuration(uint256 unbondingDuration);\nevent Delegate(address pool, address validator, uint256 amount);\nevent Undelegate(address pool, address validator, uint256 amount);\n```\n\n**Function**\n\n`getRate`: get the exchange rate of rBNB.\n\n```js\nfunction getRate() external view override returns (uint256) {\n  return rate;\n}\n```\n\n`getBondedPools`: get the sets of staking pool addresses.\n\n```js\nfunction getBondedPools() external view returns (address[] memory pools) {\n        pools = new address[](bondedPools.length());\n        for (uint256 i = 0; i < bondedPools.length(); ++i) {\n            pools[i] = bondedPools.at(i);\n        }\n        return pools;\n    }\n```\n\n`getValidatorsOf`: get the sets of validator addresses, where each set represents the validators to which StaFi has delegated staking pool BNB.\n\n```js\nfunction getValidatorsOf(address _poolAddress) external view returns (address[] memory validators) {\n        validators = new address[](validatorsOf[_poolAddress].length());\n        for (uint256 i = 0; i < validatorsOf[_poolAddress].length(); ++i) {\n            validators[i] = validatorsOf[_poolAddress].at(i);\n        }\n        return validators;\n    }\n```\n`getUnstakeIndexListOf`: get the unstake index List.\n\n```js\nfunction getUnstakeIndexListOf(address _staker) external view returns (uint256[] memory unstakeIndexList) {\n        unstakeIndexList = new uint256[](unstakeOfUser[_staker].length());\n        for (uint256 i = 0; i < unstakeOfUser[_staker].length(); ++i) {\n            unstakeIndexList[i] = unstakeOfUser[_staker].at(i);\n        }\n        return unstakeIndexList;\n    }\n```\n\n`stake`: allow users to perform stake operations, stake BNB into the staking pool, and receive rBNB in return.\n\n```js\nfunction stake(uint256 _stakeAmount) external payable {\n        stakeWithPool(bondedPools.at(0), _stakeAmount);\n    }\n```\n\n`unstake`: allow users to perform unstake operations, burn rBNB, and record the corresponding amount of BNB.\n\n```js\nfunction unstake(uint256 _rTokenAmount) external payable {\n        unstakeWithPool(bondedPools.at(0), _rTokenAmount);\n    }\n```\n\n`withdraw`: allow users to perform withdrawal operations and withdraw unstaked BNB to their wallet.\n\n```js\nfunction withdraw() external payable {\n        withdrawWithPool(bondedPools.at(0));\n    }\n```\n\n`settle`: permissionless, allow users to update delegation and undelegation by calling the contract, enabling them to claim their principal and reward in a fully decentralized manner.\n\n```js\nfunction settle(address _poolAddress) public {\n        require(bondedPools.contains(_poolAddress), \"pool not exist\");\n        _checkAndRepairDelegated(_poolAddress);\n\n        // claim undelegated\n        IStakePool(_poolAddress).checkAndClaimUndelegated();\n\n        PoolInfo memory poolInfo = poolInfoOf[_poolAddress];\n\n        // cal pending value\n        uint256 pendingDelegate = pendingDelegateOf[_poolAddress].add(poolInfo.bond);\n        uint256 pendingUndelegate = pendingUndelegateOf[_poolAddress].add(poolInfo.unbond);\n\n        uint256 deduction = pendingDelegate > pendingUndelegate ? pendingUndelegate : pendingDelegate;\n        pendingDelegate = pendingDelegate.sub(deduction);\n        pendingUndelegate = pendingUndelegate.sub(deduction);\n\n        // update pool state\n        poolInfo.bond = 0;\n        poolInfo.unbond = 0;\n        poolInfoOf[_poolAddress] = poolInfo;\n\n        _settle(_poolAddress, pendingDelegate, pendingUndelegate);\n    }\n```\n\n## Multisig\n\nTo ensure security and decentralization in managing and configuring the staking pool, we wil introduce multisig and implement it through threshold signatures.\n\n## Relay\n\nTo update delegation and undelegation operations in the contract, we have developed a newly designed and simplified service called Relay. This service triggers Era updates and synchronizes unrewarded data from the BSC chain that has not yet been synced to the contract, ensuring the accuracy of exchange rates. Because the reward will only be synced to BSC when it is greater than 1 BNB.\n\nIf the contract can synchronize any amount of stake rewards on BSC in the future, Relay will evolve into a permissionless service. Its function will be limited to triggering era updates on a scheduled basis, which will enhance security and decentralization even further.\n\n# Security Considerations\n\nRelay is an offline service that is vulnerable to slashing or attacks. If it remains unrecoverable for an extended period, users can call the settle function in the contract to initiate delegation and undelegation operations, allowing them to withdraw their assets. Furthermore, to ensure exchange rate stability, a rateChangeLimit has been implemented to ensure that the exchange rate increases linearly.\n\nIn addition, asset migration and security are important considerations. To ensure security, we will conduct audits and repeated testing, and closely monitor the migration process for any potential issues.\n\n# Copyright\n\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).",
    "iso8601Date": "2023-07-16T00:00:00+00:00",
    "basename": "sip3"
  },
  "sip4": {
    "title": "[SIP-4]A New Liquid Staking Implementation for MATIC Using the EVM LSD Architecture",
    "description": "In SIP-3 1, the StaFi team proposed a new implementation of BNB liquid staking using EVM LST Architecture, which represents a significant improvement in both the usability and security of the staking process. We are dedicated to further promoting the adoption of the EVM LST Architecture, and as part of this effort, we are proposing to migrate rMATIC to this new architecture and decoupling rMATIC from the StaFi Chain. After the migration is completed, both the usability and security of rMATIC will be improved.",
    "date": "2023-06-29T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/sip-4-a-new-liquid-staking-implementation-for-matic-using-the-evm-lsd-architecture/90",
    "preview": "# Abstract\n\nIn SIP-3 1, the StaFi team proposed a new implementation …",
    "content": "\n\n# Abstract\n\nIn SIP-3 1, the StaFi team proposed a new implementation of BNB liquid staking using EVM LST Architecture, which represents a significant improvement in both the usability and security of the staking process. We are dedicated to further promoting the adoption of the EVM LST Architecture, and as part of this effort, we are proposing to migrate rMATIC to this new architecture and decoupling rMATIC from the StaFi Chain. After the migration is completed, both the usability and security of rMATIC will be improved.\n\n# Motivation\n\nrMATIC is an important part of the rToken, issued on the StaFi Chain. However, there are some usability issues. users need to have two wallets and sign multiple transactions to mint rMATIC.\n\nSwitching rMATIC to the EVM LSD architecture can solve the usability issues mentioned above. Additionally, we have made some security updates, including introducing the Native Staking contract interface for Polygon POS, and simplifying relay services, among others.\n\n# Specification\n\n## Overview\n\n![MATIC](/image/sip4_1.jpeg \"MATIC staking\")\n\nSince the Polygon POS staking contract is deployed on the Ethereum, the MATIC staking contract has been designed to also be deployed on the Ethereum.\n\nThere are mainly three components:\n\n- Staking contracts on Ethereum: A new set of contracts has been designed to implement MATIC liquid staking on the Ethereum.\n- rMATIC relay: A newly designed and simplified service is used to trigger Era updates in the contract for delegation and undelegation operations. This is a permissionless service, which means that anyone can run it to update the era.\n- System staking contract on Ethereum: A system contract in charge of handling MATIC staking requests on Ethereum.\n\nThis new set of contracts has been specifically designed to enable liquid staking for MATIC on the Ethereum, offering all the fundamental features of a MATIC liquid staking service, including minting and burning rMATIC, depositing and withdrawing MATIC, as well as staking pool management, among other functionalities.\n\n## System Staking Contract Interface\n\nThe Polygon provides two contract interfaces for staking, which enable the implementation of staking-related features on the Ethereum by using `IGovStakeManager.sol` and `IValidatorShare.sol`.\n\n```js\npragma solidity 0.7.6;\n\n// SPDX-License-Identifier: GPL-3.0-only\n\ninterface IGovStakeManager {\n    function migrateDelegation(uint256 fromValidatorId, uint256 toValidatorId, uint256 amount) external;\n\n    function epoch() external view returns (uint256);\n\n    function withdrawalDelay() external view returns (uint256);\n\n    function getValidatorContract(uint256 validatorId) external view returns (address);\n}\n```\n\n```js\n// SPDX-License-Identifier: GPL-3.0-only\n\ninterface IValidatorShare {\n    struct DelegatorUnbond {\n        uint256 shares;\n        uint256 withdrawEpoch;\n    }\n\n    function withdrawRewards() external;\n\n    function buyVoucher(uint256 _amount, uint256 _minSharesToMint) external returns (uint256 amountToDeposit);\n\n    function sellVoucher_new(uint256 claimAmount, uint256 maximumSharesToBurn) external;\n\n    function unstakeClaimTokens_new(uint256 unbondNonce) external;\n\n    function restake() external returns (uint256, uint256);\n\n    function getTotalStake(address user) external view returns (uint256, uint256);\n\n    function getLiquidRewards(address user) external view returns (uint256);\n\n    function unbonds_new(address user, uint256 nonce) external view returns (DelegatorUnbond calldata);\n}\n```\n## Staking Pool\n\n### Data Structs\n\n```js\nEnumerableSet.AddressSet bondedPools;\nmapping(address => PoolInfo) public poolInfoOf;\nmapping(address => EnumerableSet.UintSet) validatorIdsOf;\nmapping(address => mapping(uint256 => uint256)) public maxClaimedNonceOf; // pool => validator Id => max claimed nonce\nmapping(uint256 => uint256) public eraRate;\n\n// unstake info\nuint256 public nextUnstakeIndex;\nmapping(uint256 => UnstakeInfo) public unstakeAtIndex;\nmapping(address => EnumerableSet.UintSet) unstakesOfUser;\n```\n\n- `poolInfoOf`: record the information and status about the staking pool .\n- `validatorsOf`: record sets of validator addresses, where each set represents the validators to which StaFi has delegated staking pool MATIC.\n- `maxClaimedNonceOf`: record the maximum nonce that the address has claimed for reward\n- `eraRate`: record rMATIC exchange rate\n- `unstakeAtIndex`: record the unstake info.\n- `unstakeOfUser`: record the unbond index of users who have not withdrawn.\n\n### Events\n\n```js\nevent Stake(address staker, address poolAddress, uint256 tokenAmount, uint256 rTokenAmount);\nevent Unstake(\n        address staker,\n        address poolAddress,\n        uint256 tokenAmount,\n        uint256 rTokenAmount,\n        uint256 burnAmount,\n        uint256 unstakeIndex\n    );\nevent Withdraw(address staker, address poolAddress, uint256 tokenAmount, int256[] unstakeIndexList);\nevent ExecuteNewEra(uint256 indexed era, uint256 rate);\nevent SetUnbondingDuration(uint256 unbondingDuration);\nevent Delegate(address pool, uint256 validator, uint256 amount);\nevent Undelegate(address pool, uint256 validator, uint256 amount);\nevent NewReward(address pool, uint256 amount);\nevent NewClaimedNonce(address pool, uint256 validator, uint256 nonce);\n```\n\n### Function\n\n`getRate`: get the exchange rate of rMATIC.\n\n```js\nfunction getRate() external view override returns (uint256) {\n  return rate;\n}\n```\n\n`getBondedPools`: get the sets of staking pool addresses.\n\n```js\nfunction getBondedPools() external view returns (address[] memory pools) {\n        pools = new address[](bondedPools.length());\n        for (uint256 i = 0; i < bondedPools.length(); ++i) {\n            pools[i] = bondedPools.at(i);\n        }\n        return pools;\n    }\n```\n\n`getValidatorsOf`: get the sets of validator addresses, where each set represents the validators to which StaFi has delegated staking pool MATIC.\n\n```js\nfunction getValidatorsOf(address _poolAddress) external view returns (address[] memory validators) {\n        validators = new address[](validatorsOf[_poolAddress].length());\n        for (uint256 i = 0; i < validatorsOf[_poolAddress].length(); ++i) {\n            validators[i] = validatorsOf[_poolAddress].at(i);\n        }\n        return validators;\n    }\n```\n`getUnstakeIndexListOf`: get the unstake index List.\n\n```js\nfunction getUnstakeIndexListOf(address _staker) external view returns (uint256[] memory unstakeIndexList) {\n        unstakeIndexList = new uint256[](unstakeOfUser[_staker].length());\n        for (uint256 i = 0; i < unstakeOfUser[_staker].length(); ++i) {\n            unstakeIndexList[i] = unstakeOfUser[_staker].at(i);\n        }\n        return unstakeIndexList;\n    }\n```\n\n`stake`: allow users to perform stake operations, stake MATIC into the staking pool, and receive rMATIC in return.\n\n```js\nfunction stake(uint256 _stakeAmount) external payable {\n        stakeWithPool(bondedPools.at(0), _stakeAmount);\n    }\n```\n\n`unstake`: allow users to perform unstake operations, burn rMATIC, and record the corresponding amount of MATIC.\n\n```js\nfunction unstake(uint256 _rTokenAmount) external payable {\n        unstakeWithPool(bondedPools.at(0), _rTokenAmount);\n    }\n```\n\n`withdraw`: allow users to perform withdrawal operations and withdraw unstaked MATIC to their wallet.\n\n```js\nfunction withdraw() external payable {\n        withdrawWithPool(bondedPools.at(0));\n    }\n```\n\n## Relay\n\nTo update delegation and undelegation operations in the contract, we have developed a newly designed and simplified service called Relay. This service triggers Era updates, ensuring the accuracy of exchange rates. This is also a permissionless service, which means that anyone can run it to update the era.\n\n## Security Considerations\n\nRelay is an offline service that is vulnerable to slashing or attacks. However, since it is a permissionless service, anyone can run it to minimize this risk.\n\nIn addition, asset migration and security are important considerations. To ensure security, we will conduct audits and repeated testing, and closely monitor the migration process for any potential issues.\n\n\n# Copyright\n\nCopyright and related rights waived via [CC0](https://creativecommons.org/publicdomain/zero/1.0/).",
    "iso8601Date": "2023-06-29T00:00:00+00:00",
    "basename": "sip4"
  },
  "sip5": {
    "title": "[SIP-5] Enhancing User Experience and Branding through Merging rToken Applications on StaFi Chain and StaFi Hub ",
    "description": "This proposal seeks to merge the rToken applications on the StaFi Chain and the StaFi Hub. This will simplify the user experience and make it easier for StaFi to reach a wider audience.",
    "date": "2023-07-18T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/sip-5-enhancing-user-experience-and-branding-through-merging-rtoken-applications-on-stafi-chain-and-stafi-hub/96",
    "preview": "# Abstract\n\nStaFi is a multi-chain liquid staking protocol that …",
    "content": "\n\n# Abstract\n\nStaFi is a multi-chain liquid staking protocol that enables users to unlock the liquidity of their staked assets. It offers extensive token support for various blockchain ecosystems including EVM chains like ETH, MATIC, and BNB, as well as Cosmos chains such as ATOM, IRIS, HUAHUA, and SWTH. Furthermore, it supports Polkadot-based chains like DOT and KSM, and Solana chains like SOL.\n\nPreviously, the rToken applications on the StaFi Chain and the StaFi Hub operated and updated independently. This led to some confusion among users, as they were not sure which application to use. It also made it difficult for StaFi to promote its products and services to a wider audience.\n\nThis proposal seeks to merge the rToken applications on the StaFi Chain and the StaFi Hub. This will simplify the user experience and make it easier for StaFi to reach a wider audience.\n\n# Motivation\n\nIn SIP-2, we explored the possibility of decoupling rTokens to improve the overall rToken experience. As part of this effort, we are working to merge the rToken applications on both the StaFi Chain and StaFi Hub. This integration will provide users with a seamless and consistent experience, eliminating any potential confusion that may result from using separate applications on different platforms.\n\nMoreover, the merger can lead to improved operational efficiency by consolidating resources and streamlining development efforts. With a single application to maintain and update, StaFi’s development team can focus on enhancing the protocol’s features and functionality, rather than allocating resources to maintaining and updating two separate applications. This will result in quicker updates, faster bug fixes, and a more efficient allocation of resources, benefiting both the development team and the users of StaFi.\n\nIn addition, the merger can enhance StaFi’s branding by presenting a more cohesive and unified image to the community. Consolidating the rToken applications on a single platform can create a more seamless and recognizable brand identity, increasing brand awareness and recognition in the market. This can also improve the user experience and perception of StaFi, ultimately driving increased adoption and usage of the protocol. By improving both operational and branding efficiency, the merger can help StaFi achieve its goals and objectives more effectively.\n\n# Specification\n\n![rToken App](/image/sip5_1.png \"rToken App\")\n\nCurrently, users must differentiate between the rToken applications on the StaFi Chain and StaFi Hub to stake and unstake tokens, leading to suboptimal user experience.\n\n![rToken App](/image/sip5_2.png \"rToken App\")\n\nTo address these issues, we propose a new user experience that involves merging the rToken applications on the StaFi Chain and StaFi Hub into a single application. This application will differentiate tokens based on their underlying chain ecosystem, and users can switch between different chains to stake and unstake tokens within the corresponding ecosystem. The specific differentiation rules are as follows:\n\n- EVM: ETH, MATIC, BNB\n- Cosmos: ATOM, IRIS, SWTH, HUAHUA\n- Polkadot: FIS,DOT, KSM\n- Solana: SOL\n\nMoreover, we have redesigned the UI and UX of the new rToken app to streamline user operations. The new design provides a more consistent and cohesive experience, eliminating any confusion arising from using separate applications on different platforms. This creates a streamlined and user-friendly interface, making it easier for users to understand the functionality and benefits of StaFi.\n\nFurthermore, we have unified our technology and services, creating a more efficient maintenance and expansion process. With only one set of services to maintain, StaFi’s development team can focus on enhancing the protocol’s features and functionality, rather than allocating resources to maintaining and updating separate applications. This leads to faster updates, bug fixes, and more efficient resource allocation, benefiting both the development team and the users of StaFi.\n\nAt the operational level, we will consolidate accounts and focus our operational resources on the StaFi_Protocol account. Additionally, we will merge related documents, such as the user guide, and migrate them from GitBook to GitHub. This migration will enable everyone to contribute to the content through GitHub, making it easier to update and maintain our documentation. Overall, these updates to our product and technology will enhance the user experience and make our maintenance and expansion processes more efficient.\n\nOverall, these updates to our product and technology will enhance the user experience and make our maintenance and expansion processes more efficient.\n\n# Copyright\nCopyright and related rights waived via CC0 .",
    "iso8601Date": "2023-07-18T00:00:00+00:00",
    "basename": "sip5"
  },
  "sip6": {
    "title": "[SIP-6]Proposal To Remove Redundant Bridges On The rBridge",
    "description": "As StaFi transitions to its new charter - which includes a new rToken construction and updated Tokenomics, several infrastructures require modifications to align with these changes. A notable example of these updates is the recent launch of the rToken merged app.",
    "date": "2023-08-10T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/sip-6-proposal-to-remove-redundant-bridges-on-the-rbridge/107",
    "preview": "# Abstract\n\nAs StaFi transitions to its new charter - which includes …",
    "content": "\n\n# Abstract\n\nAs StaFi transitions to its new charter - which includes a new rToken construction and updated Tokenomics, several infrastructures require modifications to align with these changes. A notable example of these updates is the recent launch of the rToken merged app.\n\nThis proposal outlines a forthcoming update concerning the rBridge. The rBridge is designed to enhance the interoperability of rTokens issued on the StaFi Chain or StaFi Hub.These rTokens can be seamlessly transferred to target chains, such as Ethereum, BSC, and Cosmos, and can be integrated into DeFi. With this update, certain bridges within the rBridge tool will be removed to mitigate potential risks associated with unused bridges.\n\n# Motivation\n\nThere are 3 simple reasons that we need to do the update:\n- To mitigate potential risks from unused bridges.\n- To conserve development resources.\n- To align with the protocol’s latest updates.\n\n# Specifications\n\nThe chart below illustrates StaFi’s currently available bridges for the rTokens and FIS. It also highlights the recommended bridges for removal and suggests which assets should reside on the target chains. For example, the two-way bridge for rETH between StaFi Chain and Ethereum is recommended for removal, given that rETH is exclusively issued on Ethereum and participates in Ethereum’s DeFi ecosystem.\n\n![bridge](/image/sip6_1.jpeg \"bridge\")\n\nDirect removal of the bridges could pose a problem, as some assets might end up trapped on unintended chains, rendering them ineffective. Based on our analysis, we suggest offering a 1-month window for community members to bridge their assets. During this period, users can transfer their assets to the desired chains before the bridges are removed.\n\nThere would be no incentive to retain assets on an unintended chain. If you don’t possess any assets on these chains, no action is required on your part.\n\n# Following Actions\n\nThis is a signal proposal, and we welcome all feedback.\n\nShould no critical concerns be raised in this discussion, the 1-month window will commence at 0:00 UTC on 15th Aug 2023 and conclude at 0:00 UTC on 15th Sept 2023. The bridges marked for removal in the table above will be removed following this period.\n\n# Annex\n- In addition to the rBridge on StaFi, layer1 Official Bridges may also be used to bridge rTokens to other ecosystems.\n\n![bridge](/image/sip6_2.jpeg \"bridge\")\n\n- We are exploring the possibility of establishing a bridge for rDOT and rKSM to Moonbean, an EVM compatible parachain of Polkadot. Research is currently ongoing, with further details being released in due course.",
    "iso8601Date": "2023-08-10T00:00:00+00:00",
    "basename": "sip6"
  },
  "sip7": {
    "title": "[SIP-7] StaFi Router and integration of SSV DVT infrastructure ",
    "description": "DVT (Distributed Validator Technology), by allowing validators to run on multiple nodes or machines, has the potential to significantly enhance the decentralization and security of Ethereum. In light of this, StaFi has decided to integrate DVT into its ETH liquid staking service via a new module called StaFi Router, which will enable us to implement this technology and further enhance the security and decentralization of the Ethereum network.",
    "date": "2023-08-23T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/sip-7-stafi-router-and-integration-of-ssv-dvt-infrastructure/108",
    "preview": "# Abstract\n\nDVT (Distributed Validator Technology), by allowing …",
    "content": "\n\n# Abstract\n\nDVT (Distributed Validator Technology), by allowing validators to run on multiple nodes or machines, has the potential to significantly enhance the decentralization and security of Ethereum. In light of this, StaFi has decided to integrate DVT into its ETH liquid staking service via a new module called StaFi Router, which will enable us to implement this technology and further enhance the security and decentralization of the Ethereum network.\n\n# Motivation\n\nDVT is a technology primitive that enables an Ethereum PoS Validator to run on multiple nodes or machines, allowing an individual, group, or community of operators to operate a cluster of nodes as a single validator on Ethereum.\n\nThe current StaFi ETH liquid staking validator function supports trust validators and solo validators. To support DVT and accommodate future expansion of validator types, we have developed a new module called Router. Router will integrate existing validator services with upcoming SSV support and use its allocation algorithm to assign user staked ETH to the corresponding validator.\n\n# Specification\n\n## Overview\n\n![StaFi Router](/image/sip7_1.jpeg \"StaFi Router\")\n\nGeneral module\n\nStaking Pool Manager Contract：Handling user operations such as staking, unstaking, or withdrawing.\n- IERC20 Token Contract: rETH token contract on Ethereum.\n- Staking Pool Contracts: Implementation of the core functions of the staking pool.\n- Ethereum Deposit Contract: Ethereum staking deposit contract\n- StaFi Router: A router used for validator selection, activation and management.\n- StaFi Relay: Off Chain: Data synchronization and scheduled trigger to update era .\n\n## Router Algorithm\n\nThe Router will monitor the events and balance of the staking pool. The pool will set aside a specific amount of ETH for withdrawals. If the pool’s valid balance exceeds 20 ETH, users can choose to deposit 12 ETH as a solo validator and use their own server or SSV to activate the validator on the Beacon Chain. This activation process needs to be done manually. Once the pool’s valid balance exceeds 32 ETH, the Router will automatically generate a validator key, register a validator with SSV, and activate the validator on the Beacon Chain.\n\nTo increase decentralization, we plan to decrease the number of trust validators and use them only as a backup.\n\n![StaFi Router](/image/sip7_2.jpeg \"StaFi Router\")\n\n## SSV integration\n\nStaFi Router integrates with SSV using its API and SDK.\n\n```mermaid\nsequenceDiagram\nStaFi contracts-->>StaFi Router: 32ETH\nStaFi Router->>StaFi Router: generate validator key\nStaFi Router->>StaFi Router: init validator info\nStaFi Router->>SSV:select 4 operator and register validator on SSV\nSSV->>SSV:encyped validator key\nStaFi Router->>SSV:active validator on SSV\nSSV->>Beacon(Ethereum):validator\nStaFi contracts-->>Deposit Contract(Ethereum):32ETH\nStaFi Router->>SSV:set fee recipient address and pay fee\nBeacon(Ethereum)-->>StaFi contracts:rewards\n```\n\n- Struct `Task` : A structure containing all relevant information about the SSV integration.\n\n```js\ntype Task struct {\n\tstop            chan struct{}\n\teth1StartHeight uint64\n\teth1Endpoint    string\n\teth2Endpoint    string\n\n\tsuperNodeKeyPair *secp256k1.Keypair\n\tssvKeyPair       *secp256k1.Keypair\n\n\tgasLimit            *big.Int\n\tmaxGasPrice         *big.Int\n\tpoolReservedBalance *big.Int\n\tseed                []byte\n\tpostUptimeUrl       string\n\tisViewMode          bool\n\ttargetOperatorIds   []uint64\n\n\tstorageContractAddress         common.Address\n\tssvNetworkContractAddress      common.Address\n\tssvNetworkViewsContractAddress common.Address\n\tssvTokenContractAddress        common.Address\n\n\t// --- need init on start\n\tdev           bool\n\tssvApiNetwork string\n\tchain         constants.Chain\n\n\tconnectionOfSuperNodeAccount *connection.Connection\n\tconnectionOfSsvAccount       *connection.Connection\n\n\teth1WithdrawalAdress       common.Address\n\tfeeRecipientAddressOnStafi common.Address\n\tlatestRegistrationNonce    uint64\n\n\teth1Client *ethclient.Client\n\teth2Config beacon.Eth2Config\n\n\tsuperNodeContract       *super_node.SuperNode\n\tuserDepositContract     *user_deposit.UserDeposit\n\tssvNetworkContract      *ssv_network.SsvNetwork\n\tssvNetworkViewsContract *ssv_network_views.SsvNetworkViews\n\tssvTokenContract        *erc20.Erc20\n\twithdrawContract        *withdraw.Withdraw\n\n\tssvNetworkAbi abi.ABI\n\n\tnextKeyIndex               int\n\tdealedEth1Block            uint64 // for offchain state\n\tvalidatorsPerOperatorLimit uint64\n\n\tvalidatorsByKeyIndex      map[int]*Validator    // key index => validator, cache all validators(pending/active/exist) by keyIndex\n\tvalidatorsByPubkey        map[string]*Validator // pubkey => validator, cache all validators(pending/active/exist) by pubkey\n\tvalidatorsByValIndex      map[uint64]*Validator // val index => validator\n\tvalidatorsByValIndexMutex sync.RWMutex\n\n\t// ssv offchain state\n\tclusters                 map[string]*Cluster // cluster key => cluster\n\tfeeRecipientAddressOnSsv common.Address\n\n\thandlers     []func() error\n\thandlersName []string\n}\n```\n\n- Struct `Validator` : A structure containing all relevant information about the SSV validator.\n\n```js\ntype Validator struct {\n\tprivateKey    *bls.PrivateKey\n\tkeyIndex      int\n\tstatus        uint8\n\tregistedOnSSV bool\n\tremovedOnSSV  bool\n}\n```\n\n- Struct `Cluster` : A structure containing all relevant information about the SSV cluster.\n\n```js\ntype Cluster struct {\n\toperators     []*keyshare.Operator\n\toperatorIds   []uint64\n\tlatestCluster *ssv_network.ISSVNetworkCoreCluster\n\n\tbalance decimal.Decimal\n\n\tmanagingValidators map[int]struct{} // key index\n\n\tlatestUpdateClusterBlockNumber    uint64\n\tlatestValidatorAddedBlockNumber   uint64\n\tlatestValidatorRemovedBlockNumber uint64\n\n\thasTargetOperators bool\n}\n```\n\n- `function checkAndOnboardOnSSV`: select operators and register validator to SSV.\n- `function checkAndDeposit`: generate validate key, check the pool balance and init validator.\n- `function checkAndStake`: active validator on SSV.\n- `function updateOperatorStatus` : check and update the status of the selection operators.\n- `function checkAndSetFeeRecipient` : set fee recipient address.\n- `function checkAndOffboardOnSSV` : validator on SSV exit.\n- `function updateSsvOffchainState` : Syncing data and receiving events.\n- `function updateCluster` : check and update the meta of the cluster.\n- `function checkAndReactiveOnSSV` : reactive the cluster on SSV\n\n## Distribute Validator Key Generate\n\nAs the development of SSV’s DKG is currently in progress, the process of generating Validator Keys requires careful consideration of performance and security to ensure a high level of decentralization.\n\nIn the long term, once SSV’s DKG is completed, we will replace the current scheme with SSV’s DKG to further enhance security and decentralization.\n\n## Smart operator selection\n\nSSV operators are evaluated based on various metrics such as price, status, and performance, as well as dynamic operations such as updated fees and off-boarding. To ensure optimal operator selection, the StaFi Router will periodically search for operator information on the SSV network at certain frequencies.\n\nSSV related api:\n- `/api/v4/{network}/operators`: SSV operator list\n- `/api/v4/{network}/operators/operator`: SSV operator detail\n\n# Security Considerations\n\nStaFi Router operates as an off-chain service, there is a possibility of server failures that can result in delayed rewards and prevent the ability to run new validators in SSV. In addition, there is a risk of being targeted by attackers, which could lead to validators being slashed.\n\n# Copyright\n\nCopyright and related rights waived via CC0 .",
    "iso8601Date": "2023-08-23T00:00:00+00:00",
    "basename": "sip7"
  },
  "sip8": {
    "title": "[SIP-8]StaFi LSM Integration Proposal",
    "description": "Cosmos Liquid Staking Module (LSM) is a modular component that enables liquid staking for any chain in the Cosmos ecosystem. LSM allows users to convert their staked assets into liquid assets without unbonding, which will help to improve the liquidity and security of the Cosmos ecosystem and pave the way for new DeFi applications. By integrating with LSM module, it will be easier for staked ATOM users to participate in StaFi staking service and thus help StaFi to attract more users and grow its community.",
    "date": "2023-09-07T00:00:00.000Z",
    "status": 2,
    "snapshotlink": null,
    "discusslink": "https://dao.stafi.io/t/sip-8-stafi-lsm-integration-proposal/116",
    "preview": "# Abstract\n\nCosmos Liquid Staking Module (LSM) is a modular …",
    "content": "\n\n# Abstract\n\nCosmos Liquid Staking Module (LSM) is a modular component that enables liquid staking for any chain in the Cosmos ecosystem. LSM allows users to convert their staked assets into liquid assets without unbonding, which will help to improve the liquidity and security of the Cosmos ecosystem and pave the way for new DeFi applications. By integrating with LSM module, it will be easier for staked ATOM users to participate in StaFi staking service and thus help StaFi to attract more users and grow its community.\n\n# Motivation\n\nWithout LSM, it is inconvenient for staked ATOM users to participate in the StaFi protocol. If they want to participate, they must first undelegate and wait 21 days before participating in the LSD protocol. This is inconvenient and will lose unbonding earnings. With LSM, users can migrate to the LSD protocol directly and losslessly with one-click operation through the LSM module without undelegate, and will not lose any earnings.\n\n## Why LSD is a must for LSM?\n\nThe Liquid Staking Manager (LSM) module allows users to transfer their staked ATOM to a liquid staking account, which mints the corresponding amount of rATOM to their wallet. This allows users to participate in the LSD protocol immediately and without any loss of earnings. However, there are still some limitations to using LSM alone.\n\nOne limitation is that the liquid tokens issued by LSM are not fungible. This means that they cannot be traded equally, which can be inconvenient for users who want to use their liquid tokens in DeFi applications.\n\nAnother limitation is that the liquid tokens issued by LSM are not interoperable with other DeFi protocols. This means that users cannot easily transfer their liquid tokens between different DeFi applications.\n\nThe LSD protocol solves these limitations by providing a unified liquid staking token (LST) that is fungible and interoperable with other DeFi protocols. This makes it more convenient for users to participate in DeFi applications and to trade their liquid tokens.\n\n## Why will LSM benefit the StaFi community?\n\n- Improved liquidity: The LSM module will allow StaFi users to access the liquidity of their staked assets without having to unbond them. This will make it easier for StaFi users to participate in DeFi and other applications that require liquidity.\n- Reduced risk: The LSM module will help to reduce the risk of liquid staking by providing a more secure and transparent way to participate.\n- Enhanced security: The LSM module will be implemented as a module on the Cosmos Hub blockchain, which is a secure and decentralized platform. This will help to protect StaFi users’ funds.\n- Expanded reach: The LSM module will allow StaFi to expand its reach to other Cosmos-based chains. This will give StaFi users more options and make it easier for them to participate in liquid staking.\n- Enhanced user experience: The LSM module will make it easier for staked ATOM users to participate in liquid staking. This is because the module will provide a user-friendly interface and a smooth redelegate experience.\n- Enlarge rATOM TVL: The LSM module will make it easier for users to participate in liquid staking. This will help StaFi to attract more users and grow its community.\n\n# Specification\n\n## Integration Roadmap\n\n### Ver 1\n\n- Native ATOM (Same as previous staking process)\n- On-chain Staked ATOM (Re-delegate function)\n\n### Ver 2\n\n- The TokenizeShares of LSM ATOM (Re-delegate function)\n- Selection function for LSM ATOM TokenizeShares\n\n### TBD\n\n- Other LSD LSM ATOM (Temporarily unacceptable)\n\n## User Flow\n\n![LSM](/image/sip8_1.jpeg \"LSM\")\n\n> Note: The image is just an example of how the function works. The actual output may vary slightly\n\n- Users will be able to mint rATOM by re-delegate their ATOM on the StaFi rToken APP - rATOM - Redelegate Tab.\n- Users can redeem their rATOM for ATOM at any time.\n- StaFi will provide liquidity for rATOM on major COSMOS DeFi protocols.\n- Re-delegate function will be disabled once overall liquid staked ATOM by all liquid staking providers have reached to 25% of the total supply of staked ATOM.\n\n## Features\n\n![LSM](/image/sip8_2.jpeg \"LSM\")\n\nOnce the development is complete, the StaFi rToken APP will be able to be used by users to stake their ATOM and mint rATOM. The LSM module will track the amount of ATOM that is staked and the amount of rATOM that has been minted. When a user stakes their ATOM, the LSM module will allow the user to transfer their ATOM to a liquid staking account. StaFiHub will then mint the corresponding amount of rATOM to the user’s wallet. When a user redeems their ATOM, the LSM module will allow the user to transfer their rATOM back to their ATOM account. The StaFiHub protocol will then burn the corresponding amount of rATOM.\n\n## To be Considered\n\nIn addition to the above, here are some of the challenges that need to be addressed:\n\n- Voting Power: After the launch of LSM, it means that validators with delegations from delegators could become corrupt and use their voting power to behave maliciously and delegators should select validators wisely. Currently StaFi utilize the smart delegation algorithm to select and delegate to the most performed validators, considering currently on-chain self-bond validator amount are very few (normally from 1- 60), which means it could easily achieve the delegation limit, so self-bond amount will be one of the first consideration for StaFi delegation. On the other hand, StaFi delegator voting system is currently under investigation, more details will be released soon.\n- Consumer chain rewards: Consumer chains in the Cosmos ecosystem are blockchains that rely on the security of the Cosmos Hub. In exchange for providing security, consumer chains share their transaction fees and inflation rewards with ATOM stakers and delegators on the Cosmos Hub. The amount of rewards that consumer chains share is determined by a number of factors, including the amount of transaction fees generated by the consumer chain, the inflation rate of the consumer chain, and the number of ATOMs staked on the Cosmos Hub. The StaFi team is working to address the consumer chain rewards allocation mechanism, currently the rewards is too small we haven’t see any perfect solution regarding to this issue, while the research will keep going and we may have more updates on Q4.\n- Validator delegate panel: We will commence construction of the panel once we have accumulated sufficient staking capital and the StaFi community has expressed a measurable demand for such a panel.\n\n# Appendix\n\n## Background\n\nCurrently, liquid staking in Cosmos requires the use of third-party service providers. These providers often charge fees and may pose security risks. LSM aims to address these issues by providing users with a more direct and secure way to participate in liquid staking.\n\n### Why the Cosmos LSM module is needed:\n- To improve liquidity: Liquid staking allows users to access the liquidity of their staked assets without having to unbond them. This can be useful for users who want to participate in DeFi or other applications that require liquidity.\n- To improve security: LSM can help to improve the security of liquid staking by providing a more secure way to manage the staking process.\n- To pave the way for new DeFi applications: Liquid staking can enable new DeFi applications that require liquidity. For example, liquid staking could be used to create a lending market for staked assets.\n\n### Benefits of using the Cosmos LSM module:\n\n- Liquidity: Users can access the liquidity of their staked assets without having to unbond them. This can be useful for users who want to participate in DeFi or other applications that require liquidity.\n- Security: The Cosmos LSM module is designed to be secure and reliable. The module is implemented as a module on the Cosmos Hub blockchain, which is a secure and decentralized platform.\n- Efficiency: The Cosmos LSM module is efficient and scalable. The module can support a large number of users and transactions.\n- Interoperability: The Cosmos LSM module is interoperable with other Cosmos-based chains. This means that users can liquid stake their assets on any Cosmos chain that supports the LSM module.\n\n## How it works\n\nLSM uses a mechanism called “representative tokens” to implement liquid staking. When a user stakes their assets, they will receive a representative token. This token can be transferred and traded just like any other token. Users can redeem their assets at any time and receive the value of the representative tokens.\n\n### Limiting liquid staking\n\nThe LSM would limit the percentage of liquid staked ATOM by all liquid staking providers to 25% of the total supply of staked ATOM, in order to prevent liquid staking providers from collectively controlling more than ⅓ of the total staked ATOM supply, which is the threshold at which a group of bad actors could halt block production.\n\nTechnically speaking, this cap on liquid staked ATOM is enforced by limiting the total number of tokens that can be staked via interchain accounts and tokenized using the liquid staking module on the Cosmos Hub. Once this cap is reached, the LSM prevents interchain accounts from staking any more ATOM and prevents delegators from tokenizing any more delegations using the LSM.\n\n### Validator bond\n\nAs an additional security feature, validators who want to receive delegations from liquid staking providers would be required to self-bond a certain amount of ATOM. The validator self-bond, or “validator-bond,” means that validators need to have “skin in the game” in order to be entrusted with delegations from liquid staking providers. This disincentivizes malicious behavior by the validator and empowers the validator to negotiate its relationship with liquid staking providers. Please see the Appendix FAQ for additional descriptions of the validator bond factor and associated dynamics.\n\nTechnically speaking, the validator-bond is tracked by the LSM. The maximum number of tokens that can be delegated to a validator by a liquid staking provider is equal to the validator-bond multiplied by the “validator-bond factor.” The initial validator bond factor would be set at 250 and can be configurable by Cosmos Hub governance. Please see the appendix for details on this governance parameter and the starting value of 250.\n\nWith a validator-bond factor of 250, for every one ATOM a validator validator-bonds, that validator is eligible to receive up to two-hundred-and-fifty ATOM delegated from liquid staking providers. The validator-bond has no impact on anything other than eligibility for delegations from liquid staking providers.\n\n### Instantly liquid staking staked ATOM\n\nThe LSM enables users to instantly liquid stake their staked ATOM, without having to wait the twenty-one day unbonding period. This is important, because a very large portion of the ATOM supply is currently staked. Liquid staking ATOM that is already staked incurs a switching cost in the form of three weeks’ forfeited staking rewards. The LSM eliminates this switching cost.\n\nA user would be able to visit any liquid staking provider that has integrated with the LSM and click a button to convert his staked ATOM to liquid staked ATOM. It would be as easy as liquid staking unstaked ATOM.\n\nTechnically speaking, this is accomplished by using something called an “LSM share.” Using the liquid staking module, a user can tokenize their staked ATOM and turn it into LSM shares. LSM shares can be redeemed for underlying staked tokens and are transferable. After staked ATOM is tokenized it can be immediately transferred to a liquid staking provider in exchange for liquid staking tokens - without having to wait for the unbonding period.",
    "iso8601Date": "2023-09-07T00:00:00+00:00",
    "basename": "sip8"
  }
}
